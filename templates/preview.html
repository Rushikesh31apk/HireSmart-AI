{% extends 'base.html' %}
{% block title %}Preview Resume â€” HireSmart AI{% endblock %}

{% block content %}
<div class="preview-page">

  <!-- Toolbar -->
  <div class="preview-toolbar">
    <div class="container">
      <div class="d-flex flex-wrap justify-content-between align-items-center gap-2">
        <div class="d-flex align-items-center gap-3">
          <a href="{{ url_for('resume_form', resume_id=resume.id) }}" class="btn btn-glass btn-sm">
            <i class="fa-solid fa-pen me-1"></i>Edit
          </a>
          <span style="font-weight:700;color:var(--text-muted);font-size:0.9rem;">
            <i class="fa-solid fa-file-alt text-primary-custom me-1"></i>{{ resume.title or 'My Resume' }}
          </span>
          <span style="background:rgba(16,185,129,0.15);color:var(--success);font-size:0.75rem;
                       padding:3px 10px;border-radius:99px;font-weight:700;">
            <i class="fa-solid fa-check-circle me-1"></i>ATS Optimized
          </span>
        </div>
        <div class="d-flex gap-2">
          <button onclick="window.print()" class="btn btn-glass btn-sm">
            <i class="fa-solid fa-print me-1"></i>Print
          </button>
          <a href="{{ url_for('download_pdf', resume_id=resume.id) }}" class="btn btn-primary-glow btn-sm px-4" target="_blank">
            <i class="fa-solid fa-download me-2"></i>Download PDF
          </a>
          <a href="{{ url_for('dashboard') }}" class="btn btn-glass btn-sm">
            <i class="fa-solid fa-gauge me-1"></i>Dashboard
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Resume Paper -->
  <div class="container py-4" id="resumeArea">
    <div class="resume-paper">

      <!-- Header -->
      <div class="rp-header">
        {% if data.get('photo_file') %}
          <img src="{{ url_for('uploaded_file', filename=data.photo_file) }}"
               class="rp-photo" alt="Profile Photo">
        {% else %}
          <div class="rp-photo-placeholder">
            <i class="fa-solid fa-user"></i>
          </div>
        {% endif %}
        <div style="flex:1;">
          <div class="rp-name">{{ data.get('full_name') or user.name }}</div>
          {% if data.get('role') %}
            <div class="rp-role">{{ data.role }}</div>
          {% endif %}
          <div class="rp-contacts">
            {% if data.get('phone') %}
              <span class="rp-contact"><i class="fa-solid fa-phone"></i> {{ data.phone }}</span>
            {% endif %}
            {% if data.get('email') %}
              <span class="rp-contact"><i class="fa-solid fa-envelope"></i> {{ data.email }}</span>
            {% endif %}
            {% if data.get('address') %}
              <span class="rp-contact"><i class="fa-solid fa-location-dot"></i> {{ data.address }}</span>
            {% endif %}
            {% if data.get('linkedin') %}
              <span class="rp-contact"><i class="fa-brands fa-linkedin"></i> {{ data.linkedin }}</span>
            {% endif %}
            {% if data.get('github') %}
              <span class="rp-contact"><i class="fa-brands fa-github"></i> {{ data.github }}</span>
            {% endif %}
          </div>
        </div>
      </div>

      <div class="rp-body">

        <!-- About -->
        {% if data.get('about') %}
        <div class="rp-section">
          <div class="rp-section-title">Professional Summary</div>
          <div class="rp-about">{{ data.about }}</div>
        </div>
        {% endif %}

        <!-- Skills -->
        {% set skills = data.get('skills', {}) %}
        {% if skills and (skills.get('languages') or skills.get('tools') or skills.get('databases') or skills.get('core')) %}
        <div class="rp-section">
          <div class="rp-section-title">Technical Skills</div>
          {% if skills.get('languages') %}
          <div class="rp-skill-row">
            <span class="rp-skill-label">Languages:</span>
            <span class="rp-skill-val">{{ skills.languages }}</span>
          </div>
          {% endif %}
          {% if skills.get('tools') %}
          <div class="rp-skill-row">
            <span class="rp-skill-label">Tools & Frameworks:</span>
            <span class="rp-skill-val">{{ skills.tools }}</span>
          </div>
          {% endif %}
          {% if skills.get('databases') %}
          <div class="rp-skill-row">
            <span class="rp-skill-label">Databases:</span>
            <span class="rp-skill-val">{{ skills.databases }}</span>
          </div>
          {% endif %}
          {% if skills.get('core') %}
          <div class="rp-skill-row">
            <span class="rp-skill-label">Core Subjects:</span>
            <span class="rp-skill-val">{{ skills.core }}</span>
          </div>
          {% endif %}
        </div>
        {% endif %}

        <!-- Education -->
        {% if data.get('education') %}
        <div class="rp-section">
          <div class="rp-section-title">Education</div>
          {% for edu in data.education %}
          {% if edu.get('degree') %}
          <div class="rp-edu-item">
            <div style="display:flex;justify-content:space-between;align-items:baseline;">
              <span class="rp-edu-degree">{{ edu.degree }}</span>
              <span class="rp-edu-year">{{ edu.get('year','') }} {% if edu.get('gpa') %}| {{ edu.gpa }}{% endif %}</span>
            </div>
            {% if edu.get('school') %}
              <div class="rp-edu-school">{{ edu.school }}</div>
            {% endif %}
          </div>
          {% endif %}
          {% endfor %}
        </div>
        {% endif %}

        <!-- Projects -->
        {% if data.get('projects') %}
        <div class="rp-section">
          <div class="rp-section-title">Projects</div>
          {% for proj in data.projects %}
          {% if proj.get('name') %}
          <div class="rp-project-item">
            <div>
              <span class="rp-project-name">{{ proj.name }}</span>
              {% if proj.get('tech') %}
                <span class="rp-project-tech">{{ proj.tech }}</span>
              {% endif %}
            </div>
            {% if proj.get('description') %}
            <div class="rp-project-desc">
              <ul class="rp-bullet mb-0 ps-3">
                {% for line in proj.description.split('\n') %}
                  {% if line.strip() %}
                    <li>{{ line.strip().lstrip('â€¢-').strip() }}</li>
                  {% endif %}
                {% endfor %}
              </ul>
            </div>
            {% endif %}
            {% if proj.get('link') %}
              <a href="{{ proj.link }}" class="rp-project-link" target="_blank">
                ðŸ”— {{ proj.link }}
              </a>
            {% endif %}
          </div>
          {% endif %}
          {% endfor %}
        </div>
        {% endif %}

        <!-- Certifications -->
        {% if data.get('certifications') %}
        <div class="rp-section">
          <div class="rp-section-title">Certifications</div>
          {% for cert in data.certifications %}
          {% if cert.get('name') %}
          <div class="rp-cert-item">
            <span class="rp-cert-name">
              {{ cert.name }}{% if cert.get('issuer') %} â€” <span style="font-weight:400;color:#666;">{{ cert.issuer }}</span>{% endif %}
            </span>
            <span class="rp-cert-year">{{ cert.get('year','') }}</span>
          </div>
          {% endif %}
          {% endfor %}
        </div>
        {% endif %}

        <!-- Achievements -->
        {% if data.get('achievements') %}
        <div class="rp-section">
          <div class="rp-section-title">Achievements</div>
          <ul class="rp-bullet ps-3">
            {% for line in data.achievements.split('\n') %}
              {% if line.strip() %}
                <li>{{ line.strip().lstrip('â€¢-').strip() }}</li>
              {% endif %}
            {% endfor %}
          </ul>
        </div>
        {% endif %}

        <!-- Hobbies -->
        {% if data.get('hobbies') %}
        <div class="rp-section">
          <div class="rp-section-title">Interests & Hobbies</div>
          <div class="rp-hobbies">{{ data.hobbies }}</div>
        </div>
        {% endif %}

        <!-- Empty state -->
        {% if not data.get('about') and not data.get('skills') and not data.get('education') %}
        <div style="text-align:center;padding:3rem;color:#999;">
          <i class="fa-solid fa-file-circle-plus" style="font-size:2.5rem;margin-bottom:1rem;display:block;"></i>
          <p>Your resume is empty. <a href="{{ url_for('resume_form', resume_id=resume.id) }}" style="color:#00b4d8;">Fill in your details</a> to see the preview.</p>
        </div>
        {% endif %}

      </div><!-- /rp-body -->
    </div><!-- /resume-paper -->

    <!-- ATS Score card below resume -->
    <div class="text-center my-4">
      <div class="glass-card d-inline-block p-3 px-5">
        <div class="d-flex align-items-center gap-4">
          <div>
            <div style="font-size:2.5rem;font-weight:900;color:var(--success);line-height:1;">98</div>
            <div style="font-size:0.72rem;color:var(--text-muted);letter-spacing:1px;">ATS SCORE</div>
          </div>
          <div style="width:1px;height:40px;background:var(--border-glass);"></div>
          <div class="text-start">
            <div style="font-weight:700;font-size:0.9rem;color:var(--success);">
              <i class="fa-solid fa-check-circle me-1"></i>ATS Optimized
            </div>
            <div style="color:var(--text-muted);font-size:0.8rem;">Clean format Â· Keyword rich Â· Parseable</div>
          </div>
          <a href="{{ url_for('download_pdf', resume_id=resume.id) }}" class="btn btn-primary-glow btn-sm px-3" target="_blank">
            <i class="fa-solid fa-download me-1"></i>Download PDF
          </a>
        </div>
      </div>
    </div>

  </div><!-- /container -->
</div><!-- /preview-page -->
{% endblock %}